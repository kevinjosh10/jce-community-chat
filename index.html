<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>JCE LIVE CHAT</title> <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí¨</text></svg>"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"> <style> :root { --bg-dark: #000000; --bg-darker: #000000; --primary: #a855f7; --primary-light: #e879f9; --glass: rgba(0, 0, 0, 0.85); --glass-border: rgba(255, 255, 255, 0.1); --text-main: #f3f4f6; --text-light: #9ca3af; --success: #10b981; --error: #ef4444; } * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; } body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: white; height: 100vh; overflow: hidden; position: relative; } ::-webkit-scrollbar { width: 8px; height: 8px; } ::-webkit-scrollbar-track { background: #000000; } ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; } ::-webkit-scrollbar-thumb:hover { background: var(--primary-light); } .stars-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; } .star { position: absolute; background: white; border-radius: 50%; opacity: 0; animation: twinkle var(--duration) ease-in-out infinite; animation-delay: var(--delay); } @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } } .layer { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; animation: drift linear infinite; opacity: 0.3; } .layer-1 { animation-duration: 120s; background-image: radial-gradient(1px 1px at 10px 10px, white 1px, transparent 0); background-size: 50px 50px; } .layer-2 { animation-duration: 160s; background-image: radial-gradient(1px 1px at 20px 20px, white 1px, transparent 0); background-size: 100px 100px; } .layer-3 { animation-duration: 200s; background-image: radial-gradient(2px 2px at 30px 30px, white 1px, transparent 0); background-size: 150px 150px; } @keyframes drift { from { transform: rotate(0deg); } to { transform: rotate(360deg); } } .login-container { position: absolute; bottom: 0; left: 0; width: 100%; padding: 2rem 1rem 4rem; display: flex; justify-content: center; z-index: 20; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease; } .login-card { background: var(--glass); backdrop-filter: blur(20px); border-radius: 24px; padding: 2rem; width: 100%; max-width: 480px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5); border: 1px solid var(--glass-border); } .form-group { margin-bottom: 1.5rem; position: relative; } .form-input, .form-select { width: 100%; padding: 1rem 1rem 0.5rem; padding-top: 1.5rem; border: 2px solid #333; border-radius: 12px; font-size: 1rem; font-family: inherit; background: #111; color: var(--text-main); transition: all 0.3s; } .form-label { position: absolute; top: 1rem; left: 1rem; color: var(--text-light); font-size: 1rem; font-weight: 500; transition: all 0.2s; pointer-events: none; transform-origin: left top; } .form-input:focus, .form-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.1); } .form-input:focus+.form-label, .form-input:not(:placeholder-shown)+.form-label, .form-select:focus+.form-label, .form-select:not([value=""])+.form-label { transform: translateY(-0.75rem) scale(0.75); color: var(--primary); font-weight: 600; } .btn-primary { width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; border: none; border-radius: 12px; font-size: 1.125rem; font-weight: 700; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; } .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(168, 85, 247, 0.3); } .chat-interface { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); z-index: 30; display: flex; opacity: 0; pointer-events: none; transform: scale(0.95); transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); } .chat-interface.active { opacity: 1; pointer-events: all; transform: scale(1); } .sidebar { width: 28%; min-width: 250px; background: var(--bg-darker); border-right: 1px solid #333; display: flex; flex-direction: column; height: 100%; } .sidebar-header { padding: 1.5rem; border-bottom: 1px solid #333; } .user-profile { display: flex; align-items: center; gap: 0.75rem; } .avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.125rem; } .user-info h3 { font-size: 1rem; color: var(--text-main); font-weight: 600; } .user-info p { font-size: 0.75rem; color: var(--text-light); } .channels-list { flex: 1; overflow-y: auto; padding: 0.5rem; } .channel-group { margin-bottom: 0.25rem; } .channel-main-btn { width: 100%; text-align: left; padding: 0.75rem 1rem; margin-bottom: 0.25rem; border: none; background: transparent; border-radius: 10px; cursor: pointer; color: var(--text-light); font-weight: 600; font-size: 0.95rem; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; position: relative; user-select: none; } .channel-main-btn:hover { background: #222; transform: translateX(4px); color: var(--primary); } .channel-main-btn.active { background: #222; color: var(--primary); font-weight: 700; } .channel-main-btn.active::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 4px; height: 60%; background: var(--primary); border-radius: 0 4px 4px 0; } .channel-toggle { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; transition: transform 0.2s; font-size: 0.8rem; } .channel-group.expanded .channel-toggle { transform: rotate(90deg); } .channel-sub-list { display: none; padding-left: 0.5rem; margin-bottom: 0.25rem; } .channel-group.expanded .channel-sub-list { display: block; } .channel-sub-btn { width: 100%; text-align: left; padding: 0.6rem 0.75rem 0.6rem 1.75rem; margin-bottom: 0.2rem; border: none; background: transparent; border-radius: 8px; cursor: pointer; color: var(--text-light); font-weight: 500; font-size: 0.85rem; opacity: 0.75; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; position: relative; user-select: none; } .channel-sub-btn:hover { background: #1a1a1a; transform: translateX(2px); color: var(--primary); opacity: 1; } .channel-sub-btn.active { background: #1a1a1a; color: var(--primary); font-weight: 600; opacity: 1; } .channel-sub-btn.active::before { content: ''; position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); width: 3px; height: 50%; background: var(--primary); border-radius: 0 2px 2px 0; } .main-chat { flex: 1; display: flex; flex-direction: column; background: var(--bg-dark); height: 100%; position: relative; } .chat-header { padding: 1rem 1.5rem; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); z-index: 10; } .header-left { display: flex; align-items: center; gap: 1rem; } .mobile-menu-btn { display: none; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: 0.5rem; z-index: 50; } .desktop-header-title { display: block; } .desktop-header-title h1 { font-size: 1.25rem; font-weight: 800; background: linear-gradient(135deg, var(--primary), var(--primary-light)); -webkit-background-clip: text; background-clip: text; color: transparent; margin: 0; } .messages-container { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; scroll-behavior: smooth; } .message { max-width: 70%; display: flex; flex-direction: column; animation: slideIn 0.3s ease-out; } .message.own { align-self: flex-end; align-items: flex-end; } .message.other { align-self: flex-start; align-items: flex-start; } @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .message-bubble { padding: 0.875rem 1.125rem; border-radius: 16px; word-wrap: break-word; line-height: 1.5; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); } .message.own .message-bubble { background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; border-bottom-right-radius: 6px; } .message.other .message-bubble { background: #1a1a1a; color: var(--text-main); border-bottom-left-radius: 6px; border: 1px solid #2a2a2a; } .sender-name { font-weight: 600; font-size: 0.75rem; margin-bottom: 4px; color: var(--text-light); } .message.own .sender-name { display: none; } .message-meta { font-size: 0.7rem; margin-top: 4px; opacity: 0.6; color: var(--text-light); } .message-actions { display: flex; gap: 0.5rem; margin-top: 0.25rem; opacity: 0; transition: opacity 0.2s; } .message:hover .message-actions { opacity: 1; } .msg-action-btn { background: none; border: none; color: var(--text-light); cursor: pointer; margin-left: 8px; font-size: 1.1rem; padding: 4px; transition: color 0.2s, transform 0.2s; } .msg-action-btn:hover { color: var(--primary); transform: scale(1.15); } .reaction-btn { background: none; border: none; cursor: pointer; opacity: 0.5; font-size: 1rem; padding: 0; transition: transform 0.2s, opacity 0.2s; } .reaction-btn:hover { transform: scale(1.2); opacity: 1; } .reactions-list { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-top: 0.35rem; } .reaction-chip { background: #2a2a2a; border-radius: 12px; padding: 3px 7px; font-size: 0.75rem; display: flex; align-items: center; gap: 3px; cursor: pointer; border: 1px solid #3a3a3a; color: #ccc; transition: all 0.2s; } .reaction-chip:hover { background: #333; border-color: #4a4a4a; } .reaction-chip.active { background: rgba(168, 85, 247, 0.15); border-color: var(--primary); color: var(--primary); } .typing-indicator { padding: 0.5rem 1rem; font-size: 0.75rem; color: var(--text-light); font-style: italic; height: 24px; opacity: 0; transition: opacity 0.3s; } .typing-indicator.active { opacity: 1; } .input-area { padding: 1rem 1.5rem 1.5rem 1.5rem; border-top: 1px solid #333; background: var(--bg-darker); display: flex; gap: 1rem; align-items: flex-end; } .chat-input { flex: 1; padding: 1rem; border: 2px solid #333; border-radius: 12px; resize: none; height: 56px; max-height: 120px; font-family: inherit; font-size: 1rem; background: #111; color: white; transition: border-color 0.2s, box-shadow 0.2s; } .chat-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1); } .send-btn { width: 56px; height: 56px; border-radius: 12px; background: var(--primary); color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: all 0.2s; } .send-btn:hover { background: var(--primary-light); transform: translateY(-2px); } .send-btn:active { transform: translateY(0); } .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 100; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; } .modal-overlay.active { opacity: 1; pointer-events: all; } .modal-content { background: #111; border: 1px solid #333; border-radius: 16px; padding: 2rem; width: 90%; max-width: 400px; transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); text-align: center; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5); } .modal-overlay.active .modal-content { transform: scale(1); } .modal-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; color: white; } .modal-body { color: var(--text-main); margin-bottom: 1.5rem; } .modal-actions { display: flex; gap: 1rem; justify-content: center; } .modal-btn { padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; } .modal-btn.primary { background: var(--primary); color: white; } .modal-btn.primary:hover { background: var(--primary-light); } .modal-btn.secondary { background: transparent; border: 1px solid #333; color: var(--text-light); } .modal-btn.secondary:hover { background: #222; border-color: #555; } .modal-input { width: 100%; padding: 1rem; background: #222; border: 1px solid #333; border-radius: 8px; color: white; font-family: inherit; margin-bottom: 1rem; resize: none; } .modal-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1); } @media (max-width: 768px) { body, .sidebar, .main-chat, .chat-header { background: #000000 !important; } .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 280px; z-index: 40; transform: translateX(-100%); transition: transform 0.3s ease; border-right: 1px solid #333; } .sidebar.active { transform: translateX(0); box-shadow: 20px 0 40px rgba(0, 0, 0, 0.5); } .mobile-menu-btn { display: block; } .desktop-header-title { display: none; } .mobile-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 39; display: none; backdrop-filter: blur(3px); } .sidebar.active~.mobile-overlay { display: block; } .msg-action-btn, .reaction-btn { padding: 8px; font-size: 1.2rem; } .message { max-width: 85%; } .channel-sub-btn { padding: 0.5rem 0.5rem 0.5rem 1.5rem; font-size: 0.8rem; } .input-area { padding: 0.75rem 1rem 1rem 1rem; } .chat-input { height: 48px; } .send-btn { width: 48px; height: 48px; } } @media (max-width: 480px) { .message { max-width: 90%; } .message-bubble { padding: 0.75rem 1rem; } .sidebar { width: 75vw; } } </style> </head> <body> <div class="stars-wrapper"> <div class="layer layer-1"></div> <div class="layer layer-2"></div> <div class="layer layer-3"></div> </div> <div id="modal-container"></div> <div class="login-container" id="login-view"> <div class="login-card"> <h1 class="logo-text" style="font-size: 2.5rem; margin-bottom: 1.5rem; text-align: center;">JCE CHAT</h1> <div id="login-form"> <div class="form-group"> <input type="text" class="form-input" id="login-email" placeholder=" " autocomplete="username"> <label class="form-label">Email ID</label> </div> <div class="form-group"> <input type="password" class="form-input" id="login-pass" placeholder=" " autocomplete="current-password"> <label class="form-label">Password</label> </div> <button class="btn-primary" id="login-btn">Sign In</button> <p style="text-align: center; margin-top: 1rem; color: var(--text-light); cursor: pointer;" id="show-signup">New here? Create Account</p> </div> <div id="signup-form" style="display: none;"> <div class="form-group"> <input type="text" class="form-input" id="signup-name" placeholder=" "> <label class="form-label">Full Name</label> </div> <div class="form-group"> <input type="email" class="form-input" id="signup-email" placeholder=" "> <label class="form-label">Email Address</label> </div> <div class="form-group"> <select class="form-select" id="signup-dept"> <option value="" disabled selected></option> <option value="CSE">CSE</option> <option value="ECE">ECE</option> <option value="EEE">EEE</option> <option value="MECH">MECH</option> <option value="IT">IT</option> <option value="AIDS">AI & DS</option> </select> <label class="form-label">Department</label> </div> <div class="form-group"> <select class="form-select" id="signup-year"> <option value="" disabled selected></option> <option value="I">I Year</option> <option value="II">II Year</option> <option value="III">III Year</option> <option value="IV">IV Year</option> </select> <label class="form-label">Year</label> </div> <div class="form-group"> <input type="password" class="form-input" id="signup-pass" placeholder=" "> <label class="form-label">Password</label> </div> <button class="btn-primary" id="signup-btn">Create Account</button> <p style="text-align: center; margin-top: 1rem; color: var(--text-light); cursor: pointer;" id="show-login">Already have an account? Sign In</p> </div> <div id="verify-form" style="display: none;"> <p style="color: var(--text-main); margin-bottom: 1rem; text-align: center;">Enter the verification code sent to your email.</p> <div class="form-group"> <input type="text" class="form-input" id="verify-code" placeholder=" "> <label class="form-label">Verification Code</label> </div> <button class="btn-primary" id="verify-btn">Verify Account</button> </div> </div> </div> <div class="chat-interface" id="chat-view"> <aside class="sidebar"> <div class="sidebar-header"> <h1 style="font-size: 1.5rem; font-weight: 800; background: linear-gradient(135deg, var(--primary), var(--primary-light)); -webkit-background-clip: text; background-clip: text; color: transparent;">JCE LIVE CHAT</h1> <div class="user-profile" style="margin-top: 1rem;"> <div class="avatar" id="user-avatar">JC</div> <div class="user-info"> <h3 id="user-name">User</h3> <p id="user-details">Student</p> </div> </div> <button class="logout-btn" id="logout-btn" style="margin-top: 1rem; width: 100%; padding: 0.5rem; background: #333; border: none; color: white; border-radius: 8px; cursor: pointer; transition: all 0.2s;">Logout</button> </div> <div class="channels-list" id="channels-list"></div> </aside> <div class="mobile-overlay" id="mobile-overlay"></div> <main class="main-chat"> <header class="chat-header"> <div class="header-left"> <button class="mobile-menu-btn" id="menu-toggle">‚ò∞</button> <div class="channel-info"> <h2 id="current-channel-name" style="font-size: 1.1rem; font-weight: 600; color: var(--text-main);">üì¢ General</h2> </div> </div> <div class="desktop-header-title"> <h1>JCE LIVE CHAT</h1> </div> <div class="header-actions"> <div class="connection-status" id="connection-status"></div> </div> </header> <div class="messages-container" id="messages-container"></div> <div class="typing-indicator" id="typing-indicator"></div> <div class="input-area"> <textarea class="chat-input" id="message-input" placeholder="Type a message..." rows="1"></textarea> <button class="send-btn" id="send-btn">‚û§</button> </div> </main> </div> <script src="https://unpkg.com/aws-amplify@4.3.46/dist/aws-amplify.min.js"></script> <script> const AWS_CONFIG={aws_project_region:"ap-south-1",aws_cognito_identity_pool_id:"ap-south-1:0caa5756-e06c-4664-b192-0212359cf6a0",aws_cognito_region:"ap-south-1",aws_user_pools_id:"ap-south-1_ZqT8AaT5Y",aws_user_pools_web_client_id:"4k2pg0p5cl5kciuqahlq4kqfob",aws_appsync_graphqlEndpoint:"https://hfywlop6qjgvngsljeda262rze.appsync-api.ap-south-1.amazonaws.com/graphql",aws_appsync_region:"ap-south-1",aws_appsync_authenticationType:"AMAZON_COGNITO_USER_POOLS"};const QUERIES={list:"query ListMessages($filter: ModelMessageFilterInput, $limit: Int) { listMessages(filter: $filter, limit: $limit) { items { id channel content email name dept year timestamp createdAt } } }",create:"mutation CreateMessage($input: CreateMessageInput!) { createMessage(input: $input) { id channel content email name dept year timestamp createdAt } }",delete:"mutation DeleteMessage($input: DeleteMessageInput!) { deleteMessage(input: $input) { id } }",subscribe:"subscription OnCreateMessage($filter: ModelSubscriptionMessageFilterInput) { onCreateMessage(filter: $filter) { id channel content email name dept year timestamp createdAt } }",subscribeDelete:"subscription OnDeleteMessage($filter: ModelSubscriptionMessageFilterInput) { onDeleteMessage(filter: $filter) { id channel } }"};const CHANNELS={General:[],Academics:["Exams","Notes","Doubt Solving"],Placements:["Internships","Resume","Company Prep"],Projects:["Web","Cloud","AI / ML"],LinkedIn:["Profile Review","Content Ideas","Job Posts"],Announcements:[]};const BAD_WORDS=["fuck","shit","bitch","asshole","cunt","dick","pussy","bastard","idiot","stupid","mayiru","mair","thevdia","thevidiya","punda","pundai","ommale","ommala","sunni","poolu","kuyyam","othu","otha","omma","baadu","item","potte"];const CMD_PREFIX="CMD::";const state={user:null,currentChannel:"General",currentSubChannel:null,messages:{},subscriptions:[],amplifyReady:!1,authState:"signIn",pendingUser:null,typingUsers:{},reactions:{},expandedGroups:{}};let typingTimer=null;const $=e=>document.getElementById(e),els={};function getChannelKey(e,t=null){return t?`${e}::${t}`:e}function initAmplify(){window.aws_amplify?(window.aws_amplify.Amplify.configure(AWS_CONFIG),state.amplifyReady=!0,checkUser()):setTimeout(initAmplify,500)}async function checkUser(){try{const e=await window.aws_amplify.Auth.currentAuthenticatedUser();handleUserLoad(e)}catch(e){$("login-view").style.display="flex",$("chat-view").classList.remove("active")}}async function handleUserLoad(e){const t=e.attributes||{};state.user={id:e.username,email:t.email,name:t.name||t.email.split("@")[0],dept:t["custom:dept"]||"Student",year:t["custom:year"]||""},$("user-name").textContent=state.user.name,$("user-details").textContent=`${state.user.dept} ${state.user.year}`,$("user-avatar").textContent=state.user.name.substring(0,2).toUpperCase(),$("login-view").style.display="none",$("chat-view").classList.add("active"),loadChannel("General")}async function signIn(){const e=$("login-email").value.trim(),t=$("login-pass").value;if(!e||!t)return alert("Please enter email and password");try{const n=await window.aws_amplify.Auth.signIn(e,t);handleUserLoad(n)}catch(e){"UserNotConfirmedException"===e.code?(state.pendingUser=e,$("login-form").style.display="none",$("verify-form").style.display="block"):alert("Login Failed: "+e.message)}}async function signUp(){const e=$("signup-name").value.trim(),t=$("signup-email").value.trim(),n=$("signup-dept").value,i=$("signup-year").value,s=$("signup-pass").value;if(!t.endsWith("@jerusalemengg.ac.in"))return alert("Please use your JCE email (@jerusalemengg.ac.in)");if(!e||!s||!n||!i)return alert("All fields are required");try{await window.aws_amplify.Auth.signUp({username:t,password:s,attributes:{email:t,name:e,"custom:dept":n,"custom:year":i}}),state.pendingUser=t,$("signup-form").style.display="none",$("verify-form").style.display="block"}catch(e){alert("Signup Failed: "+e.message)}}async function verify(){const e=$("verify-code").value.trim();if(!e)return alert("Enter code");try{await window.aws_amplify.Auth.confirmSignUp(state.pendingUser,e),alert("Verified! Please sign in."),$("verify-form").style.display="none",$("login-form").style.display="block"}catch(e){alert("Verification Failed: "+e.message)}}async function logout(){await window.aws_amplify.Auth.signOut(),window.location.reload()}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>("x"===e?16*Math.random()|0:(3&Math.random()*16|8)).toString(16)))}function containsBadWords(e){return e.toLowerCase().split(/[\s,.]+/).some(e=>BAD_WORDS.includes(e))}function renderChannels(){els.channelsList.innerHTML="";for(const[e,t]of Object.entries(CHANNELS)){const n=state.expandedGroups[e],i="General"===e&&!state.currentSubChannel,s=document.createElement("div");if(s.className=`channel-group ${n?"expanded":""}`0===t.length)s.innerHTML=`<button class="channel-main-btn ${i?"active":""}" data-main-channel="${e}"><span style="font-weight: 600;">#</span> ${e}</button>`;else{s.innerHTML=`<button class="channel-main-btn ${i?"active":""}" data-main-channel="${e}"><span class="channel-toggle">‚ñ∂</span><span style="flex: 1; text-align: left;">${e}</span></button><div class="channel-sub-list">${t.map(t=>{const n=e===state.currentChannel&&t===state.currentSubChannel;return`<button class="channel-sub-btn ${n?"active":""}" data-main-channel="${e}" data-sub-channel="${t}">‚Ä¢ ${t}</button>`}).join("")}</div>`}els.channelsList.appendChild(s)}document.querySelectorAll("[data-main-channel]").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation();const t=e.target.closest("[data-main-channel]"),n=t.dataset.mainChannel,i=t.dataset.subChannel;i?loadChannel(n,i):(state.expandedGroups[n]?state.expandedGroups[n]=!1:(state.expandedGroups[n]=!0,0===CHANNELS[n].length||loadChannel(n)),renderChannels())})})}async function loadChannel(e,t=null){state.currentChannel=e,state.currentSubChannel=t,state.expandedGroups[e]=!0;const n=t?`${e} ‚Ä∫ ${t}`:e;$("current-channel-name").textContent="üì¢ "+n,window.innerWidth<=768&&(els.sidebar.classList.remove("active"),$("mobile-overlay").style.display="none"),renderChannels(),state.subscriptions.forEach(e=>{e&&e.unsubscribe&&e.unsubscribe()}),state.subscriptions=[];const i=getChannelKey(e,t),s=getCache("jce_messages_"+i);s&&(state.messages[i]=s,processMessages(state.messages[i],!0)),renderMessages();try{const e=await window.aws_amplify.API.graphql({query:QUERIES.list,variables:{filter:{channel:{eq:i}},limit:100},authMode:"AMAZON_COGNITO_USER_POOLS"}),t=e.data.listMessages.items.sort((e,t)=>new Date(e.createdAt)-new Date(t.createdAt));state.messages[i]=t,processMessages(t,!0),setCache("jce_messages_"+i,t.slice(-50))}catch(e){console.error("Fetch error",e)}subscribeToChannel(i)}function subscribeToChannel(e){try{window.aws_amplify.API.graphql({query:QUERIES.subscribe,authMode:"AMAZON_COGNITO_USER_POOLS"}).subscribe({next:({value:t})=>{const n=t.data.onCreateMessage;n.channel!==e||n.content.startsWith(CMD_PREFIX)?n.content.startsWith(CMD_PREFIX)&&applyControlMessage(n,e):(state.messages[e]||(state.messages[e]=[]),state.messages[e].some(e=>e.id===n.id)||(state.messages[e].push(n),renderMessages(),setCache("jce_messages_"+e,state.messages[e].slice(-50))))},error:e=>console.error("Create Sub error",e)}),window.aws_amplify.API.graphql({query:QUERIES.subscribeDelete,authMode:"AMAZON_COGNITO_USER_POOLS"}).subscribe({next:({value:t})=>{const n=t.data.onDeleteMessage;state.messages[e]&&((i=state.messages[e].findIndex(e=>e.id===n.id))>-1&&(state.messages[e][i].deleted=!0,renderMessages(),setCache("jce_messages_"+e,state.messages[e].slice(-50))));var i},error:e=>console.error("Delete Sub error",e)})}catch(e){console.error(e)}}function applyControlMessage(e,t){const n=e.content.split("::"),i=n[1],s=state.messages[t]||[];let a=!1;if("DELETE"===i){const e=n[2];(c=s.find(t=>t.id===e))&&(c.deleted=!0,a=!0)}else if("EDIT"===i){const e=n[2],t=n.slice(3).join("::");(c=s.find(n=>n.id===e))&&(c.content=t,c.isEdited=!0,a=!0)}else if("REACT"===i){const[,,,e,t]=n;state.reactions[e]||(state.reactions[e]={}),state.reactions[e][t]||(state.reactions[e][t]=[]),state.reactions[e][t].includes(t)||(state.reactions[e][t].push(t),a=!0)}else if("UNREACT"===i){const[,,,e,t]=n;state.reactions[e]&&state.reactions[e][t]&&((c=state.reactions[e][t].indexOf(t))>-1&&(state.reactions[e][t].splice(c,1),a=!0))}else"TYPING"===i&&((n,i)=>{state.user&&n!==state.user.id&&handleTyping(n,i)})(...n.slice(2));var c;a&&(renderMessages(),setCache("jce_messages_"+t,s.slice(-50)))}function processMessages(e,t=!1){t&&[...e].sort((e,t)=>new Date(e.createdAt)-new Date(t.createdAt)).forEach(e=>{e.content.startsWith(CMD_PREFIX)&&applyControlMessage(e,e.channel)}),renderMessages()}async function sendControlMessage(e,...t){if(!state.user)return;const n=CMD_PREFIX+e+"::"+t.join("::"),i=getChannelKey(state.currentChannel,state.currentSubChannel);try{await window.aws_amplify.API.graphql({query:QUERIES.create,variables:{input:{id:uuid(),channel:i,content:n,email:state.user.email,name:state.user.name,dept:state.user.dept||"Student",year:state.user.year||"I",timestamp:Date.now(),createdAt:(new Date).toISOString()}},authMode:"AMAZON_COGNITO_USER_POOLS"})}catch(e){console.error("CMD failed",e)}}function handleTyping(e,t){const n=Date.now();state.typingUsers[e]={name:t,time:n},renderTyping(),setTimeout(()=>{state.typingUsers[e]&&state.typingUsers[e].time===n&&(delete state.typingUsers[e],renderTyping())},3e3)}function renderTyping(){const e=Object.values(state.typingUsers).map(e=>e.name);e.length>0?($("typing-indicator").textContent=`${e.join(", ")} is typing...`,$("typing-indicator").classList.add("active")):$("typing-indicator").classList.remove("active")}function formatMessage(e){return e.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank">$1</a>')}function renderMessages(){const e=$("messages-container"),t=getChannelKey(state.currentChannel,state.currentSubChannel),n=(state.messages[t]||[]).filter(e=>!e.content.startsWith(CMD_PREFIX)&&!e.deleted);if(0===n.length)return void(e.innerHTML='<div style="text-align:center; padding:2rem; color:#666;">No messages yet. Start the conversation!</div>');e.innerHTML=n.map(e=>{const n=state.user&&e.email===state.user.email,i=new Date(e.createdAt||e.timestamp),s=isNaN(i)?"":i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=state.reactions[e.id]||{},c=Object.entries(a).map(([t,n])=>{if(!n.length)return"";const i=state.user&&n.includes(state.user.email);return`<button class="reaction-chip ${i?"active":""}" onclick="toggleReaction('${e.id}','${t}')">${t} ${n.length}</button>`}).join(""),r=n&&Date.now()-i.getTime()<6e5,o=r?`<button class="msg-action-btn" onclick="openEditModal('${e.id}')">‚úé</button>`:"",l=n?`<button class="msg-action-btn" onclick="openDeleteModal('${e.id}')">üóëÔ∏è</button>`:"";return`<div class="message ${n?"own":"other}">${n?"":`<div class="sender-name">${e.name} <small>(${e.dept})</small></div>`}<div class="message-bubble">${formatMessage(e.content)}${e.isEdited?'<small style="opacity:0.5; font-size:0.6em; margin-left:4px;">(edited)</small>':""}<div class="reactions-list">${c}</div></div><div class="message-actions">${o}${l}<button class="reaction-btn" onclick="toggleReaction('${e.id}', '‚ù§Ô∏è')">‚ù§Ô∏è</button><button class="reaction-btn" onclick="toggleReaction('${e.id}', 'üëç')">üëç</button><button class="reaction-btn" onclick="toggleReaction('${e.id}', 'üòÇ')">üòÇ</button></div><div class="message-meta">${s}</div></div>`}).join(""),e.scrollTop=e.scrollHeight}async function sendMessage(){const e=$("message-input"),t=e.value.trim();if(!t||!state.user)return;if(containsBadWords(t))return void showModal({title:"Language Warning üö´",body:"Please keep the language clean!",showCancel:!1});const n=getChannelKey(state.currentChannel,state.currentSubChannel),i={id:uuid(),channel:n,content:t,email:state.user.email,name:state.user.name,dept:state.user.dept,year:state.user.year,timestamp:Date.now(),createdAt:(new Date).toISOString(),pending:!0};state.messages[n]||(state.messages[n]=[]),state.messages[n].push(i),renderMessages(),setCache("jce_messages_"+n,state.messages[n].slice(-50)),e.value="";try{const{pending:t,...s}=i;await window.aws_amplify.API.graphql({query:QUERIES.create,variables:{input:s},authMode:"AMAZON_COGNITO_USER_POOLS"})}catch(e){console.error(e),i.failed=!0,renderMessages()}}function toggleReaction(e,t){if(!state.user)return;const n=state.reactions[e]||{},i=n[t]||[];if(i.includes(state.user.email)){const s=i.indexOf(state.user.email);i.splice(s,1),sendControlMessage("UNREACT",e,t,state.user.email)}else state.reactions[e]||(state.reactions[e]={}),state.reactions[e][t]||(state.reactions[e][t]=[]),state.reactions[e][t].push(state.user.email),sendControlMessage("REACT",e,t,state.user.email);renderMessages()}window.openEditModal=function(e){const t=getChannelKey(state.currentChannel,state.currentSubChannel);(n=state.messages[t].find(t=>t.id===e))&&showModal({title:"Edit Message ‚úé",body:`<textarea id="edit-text" class="modal-input" rows="3">${n.content}</textarea>`,actionText:"Save",onAction:()=>{const t=$("edit-text").value;if(t&&t!==n.content){if(containsBadWords(t))return void showModal({title:"Warning",body:"No bad words please.",showCancel:!1});return n.content=t,n.isEdited=!0,renderMessages(),sendControlMessage("EDIT",e,t),!0}}});var n};window.openDeleteModal=function(e){showModal({title:"Delete Message?",body:"Are you sure? This message will be removed for everyone.",actionText:"Delete üóëÔ∏è",onAction:async()=>{const t=getChannelKey(state.currentChannel,state.currentSubChannel);if(n=state.messages[t].find(t=>t.id===e)){n.deleted=!0,renderMessages(),sendControlMessage("DELETE",e);try{await window.aws_amplify.API.graphql({query:QUERIES.delete,variables:{input:{id:e}},authMode:"AMAZON_COGNITO_USER_POOLS"})}catch(e){console.error("Cloud delete failed",e)}}var n}})};function showModal({title:e,body:t,actionText:n,onAction:i,onCancel:s,showCancel:a=!0}){const c=$("modal-container");c.innerHTML=`<div class="modal-overlay active"><div class="modal-content"><div class="modal-title">${e}</div><div class="modal-body">${t}</div><div class="modal-actions">${a?'<button class="modal-btn secondary" onclick="closeModal()">Cancel</button>':""}<button class="modal-btn primary" id="modal-confirm-btn">${n||"OK"}</button></div></div></div>`,$("modal-confirm-btn").onclick=()=>{if(i){if(!1===i())return;closeModal()}else closeModal()}}window.closeModal=function(){const e=document.querySelector(".modal-overlay");e&&(e.classList.remove("active"),setTimeout(()=>$("modal-container").innerHTML="",300))};function setCache(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}}function getCache(e){try{return JSON.parse(localStorage.getItem(e))}catch(e){return null}}function setupEvents(){$("login-btn").onclick=signIn,$("signup-btn").onclick=signUp,$("verify-btn").onclick=verify,$("logout-btn").onclick=logout,$("show-signup").onclick=()=>{$("login-form").style.display="none",$("signup-form").style.display="block"},$("show-login").onclick=()=>{$("signup-form").style.display="none",$("login-form").style.display="block"},$("send-btn").onclick=sendMessage,$("message-input").onkeypress=e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),sendMessage())},$("menu-toggle").onclick=()=>{$("chat-view").querySelector(".sidebar").classList.add("active"),$("mobile-overlay").style.display="block"},$("mobile-overlay").onclick=()=>{$("chat-view").querySelector(".sidebar").classList.remove("active"),$("mobile-overlay").style.display="none"},$("message-input").oninput=()=>{typingTimer||state.user||(sendControlMessage("TYPING",state.user.id,state.user.name),typingTimer=setTimeout(()=>typingTimer=null,2e3))}}function generateStars(){const e=document.querySelector(".stars-wrapper");if(!e)return;for(let t=0;t<80;t++){const n=document.createElement("div");n.className="star",n.style.left=`${100*Math.random()}%`,n.style.top=`${100*Math.random()}%`;const i=3*Math.random()+1;n.style.width=`${i}px`,n.style.height=`${i}px`,n.style.setProperty("--duration",`${3*Math.random()+2}s`),n.style.setProperty("--delay",`${5*Math.random()}s`),e.appendChild(n)}}document.addEventListener("DOMContentLoaded",()=>{els.sidebar=document.querySelector(".sidebar"),els.channelsList=$("channels-list"),generateStars(),setupEvents(),initAmplify()}); </script> </body> </html>